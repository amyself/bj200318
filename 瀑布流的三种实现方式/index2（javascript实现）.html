<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css" rel="stylesheet">
        *{
            margin: 0;
            padding: 0;
        }
        #wrap{
            position: relative;
        }
        #wrap>.box{
            border: 1px solid #cccccc;
            border-radius: 5px;
            box-shadow: 0 0 3px #cccccc;
            padding: 10px;
            float: left;
        }
    </style>
</head>
<body>
<div id="wrap">
    <div class="box">
        <img src="image/P_00.jpg">
    </div>
    <div class="box">
        <img src="image/P_01.jpg">
    </div>
    <div class="box">
        <img src="image/P_02.jpg">
    </div>
    <div class="box">
        <img src="image/P_03.jpg">
    </div>
    <div class="box">
        <img src="image/P_04.jpg">
    </div>
    <div class="box">
        <img src="image/P_05.jpg">
    </div>
    <div class="box">
        <img src="image/P_06.jpg">
    </div>
    <div class="box">
        <img src="image/P_07.jpg">
    </div>
    <div class="box">
        <img src="image/P_08.jpg">
    </div>
    <div class="box">
        <img src="image/P_09.jpg">
    </div>
    <div class="box">
        <img src="image/P_010.jpg">
    </div>
    <div class="box">
        <img src="image/P_011.jpg">
    </div>
    <div class="box">
        <img src="image/P_012.jpg">
    </div>
    <div class="box">
        <img src="image/P_013.jpg">
    </div>
    <div class="box">
        <img src="image/P_014.jpg">
    </div>
    <div class="box">
        <img src="image/P_015.jpg">
    </div>
    <div class="box">
        <img src="image/P_016.jpg">
    </div>
    <div class="box">
        <img src="image/P_017.jpg">
    </div>
    <div class="box">
        <img src="image/P_018.jpg">
    </div>
    <div class="box">
        <img src="image/P_019.jpg">
    </div>

</div>
<script type="text/javascript">
    window.onload=function () {
        // var parent=document.getElementById("wrap")
        // var aBox=document.querySelectorAll("#wrap > div")//获取每一个div
        // var boxW=aBox[0].offsetWidth//每一个box的宽度
        // var cols=Math.floor(document.documentElement.clientWidth/boxW)//获取列数
        // parent.style.cssText="width:"+aBox*cols+"px;margin:0 padding:0;"//设置父元素的样式
        //
        // var colH=[]//每一列图片的高度
        // for(var i=0;i<aBox.length;i++){
        //     if (i<cols){//是第一列
        //         colH.push(aBox[i].offsetHeight)
        //     }else{//不是第一列
        //     var minH=Math.min.apply(null,colH)
        //     var minIndex=getMinIndex(colH,minH)
        //         aBox[i].style.position="absolute";
        //         aBox[i].style.top=minH+"px";
        //         aBox[i].style.left=aBox[minIndex].offsetLeft+"px";
        //         colH[minIndex]+=aBox[i].offsetHeight
        //
        //     }
        // }
        waterFall()

        var dataInt={"data":[{"src":"P_01.jpg"},{"src":"P_02.jpg"},{"src":"P_03.jpg"},{"src":"P_04.jpg"},{"src":"P_05.jpg"},{"src":"P_06.jpg"}]}
        //下拉列表实现懒加载
        window.onscroll=function () {
            if(dropDown()){

                for(var i=0;i<dataInt.data.length;i++){
                    var parent=document.getElementById("wrap")
                    var newDiv=document.createElement('div')
                    newDiv.className="box"
                    parent.appendChild(newDiv)
                    var newImg=document.createElement("img")
                    newImg.src="image/"+dataInt.data[i].src
                    newDiv.appendChild(newImg)
                }
        waterFall()
            }

        }

    }
    //获取最小高度索引
    function getMinIndex(arr,val) {
    for (var i in arr){
    if(arr[i]==val){
        return i
    }

}
    }

    function dropDown() {
        var aBox=document.querySelectorAll("#wrap > div")//获取每一个div
        var last=aBox[aBox.length-1]
        var totalH=last.offsetTop+Math.floor(last.offsetHeight/2)
        var scrollTop=document.body.scrollTop || document.documentElement.scrollTop;
        var clientHeight=document.body.clientHeight || document.documentElement.clientHeight;
        return (totalH<scrollTop+clientHeight)?true:false

    }
    function waterFall() {
        var parent=document.getElementById("wrap")
        var aBox=document.querySelectorAll("#wrap > div")//获取每一个div
        var boxW=aBox[0].offsetWidth//每一个box的宽度
        var cols=Math.floor(document.documentElement.clientWidth/boxW)//获取列数
        parent.style.cssText="width:"+aBox*cols+"px;margin:0 padding:0;"//设置父元素的样式

        var colH=[]//每一列图片的高度
        for (var i = 0; i < 15; i++){//清空样式
            aBox[i].style="";
        }
        for(var i=0;i<aBox.length;i++){
            if (i<cols){//是第一列
                colH.push(aBox[i].offsetHeight)
            }else{//不是第一列
                var minH=Math.min.apply(null,colH)
                var minIndex=getMinIndex(colH,minH)
                aBox[i].style.position="absolute";
                aBox[i].style.top=minH+"px";
                aBox[i].style.left=aBox[minIndex].offsetLeft+"px";
                colH[minIndex]+=aBox[i].offsetHeight

            }
        }
    }
</script>
</body>
</html>